@page "/"

@inject WeekMenuService MenuService


<PageTitle>Index</PageTitle>
<LoginDisplay />
<CascadingAuthenticationState>
    <AuthorizeView>
        <UserDisplay />
        <MenuForm />
    </AuthorizeView>
    <MenuDisplay Menu=LatestMenu Previous=PreviousMenu Next=NextMenu Update=Update/>

</CascadingAuthenticationState>

@code {
    WeekMenu? LatestMenu { get; set; }
    WeekMenu? PreviousMenu { get; set; }
    WeekMenu? NextMenu { get; set; }


    protected override async Task OnInitializedAsync()
    {
        LatestMenu = await MenuService.GetMostRecentMenuAsync();
        await Update(LatestMenu);
    }

    private async Task Update(WeekMenu menu)
    {
        LatestMenu = menu;
        PreviousMenu = await MenuService.GetPreviousWeekMenuAsync(LatestMenu.StartDate);
        NextMenu = await MenuService.GetNextWeekMenuAsync(LatestMenu.StartDate);

    }
}